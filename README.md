# Проект по курсу Python
## Описание
Этот проект - это виджет, который показывает несколько последних успешных банковских операций.
## Установка
1. Клонируйте репозиторий 
`https://github.com/Ashiuna/SkyHW.git`
2. Установите зависимости 
`poerty install`
3. Запустите файл **main.py**
## Описание функций
### get_mask_card_number
Функция `get_mask_card_number` принимает на вход номер карты и возвращает ее маску. Номер карты замаскирован и отображается в формате 
`XXXX XX** **** XXXX`, где `X` — это цифра номера. То есть видны первые 6 цифр и последние 4 цифры, остальные символы отображаются звездочками, номер разбит по блокам по 4 цифры, разделенным пробелами.
```
Пример работы функции:
7000792289606361     # входной аргумент
7000 79** **** 6361  # выход функции
```
### masks.py
#### get_mask_account
Функция `get_mask_account` принимает на вход номер счета и возвращает его маску. Номер счета замаскирован и отображается в формате 
`**XXXX` , где `X` — это цифра номера. То есть видны только последние 4 цифры номера, а перед ними — две звездочки. 
```
Пример работы функции:
73654108430135874305  # входной аргумент
**4305  # выход функции
```
#### mask_account_card
Функция умеет обрабатывать информацию как о картах, так и о счетах.
Она может:
- Принимать один аргумент — строку, содержащую тип и номер карты или счета.
Аргументом может быть строка типа 
Visa Platinum 7000792289606361, или Maestro 7000792289606361, или Счет 73654108430135874305.
- Возвращать строку с замаскированным номером. Для карт и счетов используйте разные типы маскировки.

### processing.py
#### filter_by_state
Функция принимает список словарей и опционально значение для ключа state (по умолчанию 'EXECUTED'). Функция возвращает новый список словарей, содержащий только те словари, у которых ключ `state` соответствует указанному значению.
#### sort_by_date
Функция принимает список словарей и необязательный параметр, задающий порядок сортировки (по умолчанию — убывание).

### widget.py
#### mask_account_card
Умеет обрабатывать информацию как о картах, так и о счетах.
Принимает один аргумент — строку, содержащую тип и номер карты или счета.
Возвращает строку с замаскированным номером.

Пример работы функции:
```
# Пример для карты
Visa Platinum 7000792289606361  # входной аргумент
Visa Platinum 7000 79** **** 6361  # выход функции

# Пример для счета
Счет 73654108430135874305  # входной аргумент
Счет **4305  # выход функции
```
#### get_date
Функция принимает на вход строку с датой в формате **2024-03-11T02:26:18.671407** и возвращает строку с датой в формате **ДД.ММ.ГГГГ** ("11.03.2024").
### generators.py
#### filter_by_currency
Функция принимает на вход список словарей, представляющих транзакции. Возвращает итератор, который поочередно выдает транзакции, где валюта операции соответствует заданной.

Пример использования функции:
```
for tr in filter_by_currency(transactions, "USD"):
    print(tr)
    
>>> {
          "id": 939719570,
          "state": "EXECUTED",
          "date": "2018-06-30T02:08:58.425572",
          "operationAmount": {
              "amount": "9824.07",
              "currency": {
                  "name": "USD",
                  "code": "USD"
              }
          },
          "description": "Перевод организации",
          "from": "Счет 75106830613657916952",
          "to": "Счет 11776614605963066702"
      }
      {
              "id": 142264268,
              "state": "EXECUTED",
              "date": "2019-04-04T23:20:05.206878",
              "operationAmount": {
                  "amount": "79114.93",
                  "currency": {
                      "name": "USD",
                      "code": "USD"
                  }
              },
              "description": "Перевод со счета на счет",
              "from": "Счет 19708645243227258542",
              "to": "Счет 75651667383060284188"
       }
```
#### transaction_descriptions
Функция принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.

Пример использования функции:
```
descriptions = transaction_descriptions(transactions)
for _ in range(len(transactions)):
    print(next(descriptions))

>>> Перевод организации
    Перевод со счета на счет
    Перевод со счета на счет
    Перевод с карты на карту
    Перевод организации
```
#### card_number_generator
Генератор, который выдает номера банковских карт в формате XXXX XXXX XXXX XXXX , где X — цифра номера карты. 
Он может сгенерировать номера карт в заданном диапазоне от 0000 0000 0000 0001 до 9999 9999 9999 9999.
Генератор принимает начальное и конечное значения для генерации диапазона номеров.

Пример использования функции:
```
for card_number in card_number_generator(1, 5):
    print(card_number)
    
>>> 0000 0000 0000 0001
    0000 0000 0000 0002
    0000 0000 0000 0003
    0000 0000 0000 0004
    0000 0000 0000 0005
```
### decorators.py
#### log
Декоратор, который автоматически логирует начало и конец выполнения функции, а также ее результаты или возникшие ошибки.
Декоратор принимает необязательный аргумент filename, который определяет, куда будут записываться логи (в файл или в консоль):
* Если filename задан, логи записываются в указанный файл.
* Если filename не задан, логи выводятся в консоль.

Логирование должно включать:
* Имя функции и результат выполнения при успешной операции.
* Имя функции, тип возникшей ошибки и входные параметры, если выполнение функции привело к ошибке.

Пример работы функции:
````
@log(filename="mylog.txt")
def my_function(x, y):
    return x + y

my_function(1, 2)
````
Ожидаемый вывод в лог-файл mylog.txt при успешном выполнении:
````
my_function ok
````
Ожидаемый вывод при ошибке:
````
my_function error: тип ошибки. Inputs: (1, 2), {}
````
Где тип ошибки заменяется на текст ошибки.
## Тестированине

### test_masks
#### @pytest.mark.parametrize
#### test_masks
Данные для get_mask_card_number
````
@pytest.mark.parametrize(
    "card_number, expected_result",
    [("7000792289606361", "7000 79** **** 6361"), ("1234567890123456", "1234 56** **** 3456")],
)
````

Данные для test_get_mask_account
````
@pytest.mark.parametrize(
    "account_number, expected_result",
    [("73654108430135874305", "**4305"), ("12345678901234567890", "**7890")],
)
````
#### test_get_mask_card_number
Тест функции get_mask_card_number
#### test_get_mask_account
Тест функции get_mask_account
#### test_get_mask_account_invalid
Тест функции get_mask_account на ошибки ValueError

### test_processing
Данные для test_filter_by_state, test_sort_by_date, 
````
@pytest.fixture
def fix_list() -> list[dict]:
    return [
        {"id": 41428829, "state": "EXECUTED", "date": "2019-07-03T18:35:29.512364"},
        {"id": 939719570, "state": "EXECUTED", "date": "2018-06-30T02:08:58.425572"},
        {"id": 594226727, "state": "CANCELED", "date": "2018-09-12T21:27:25.241689"},
        {"id": 615064591, "state": "CANCELED", "date": "2018-10-14T08:21:33.419441"},
    ]
````
#### test_filter_by_state
Тест функции filter_by_state
#### test_sort_by_date
Тест функции sort_by_date
#### test_sort_by_date_invalid
Тест функции sort_by_date на ошибку TypeError

### test_widget
Данные для test_mask_account_card
````
@pytest.mark.parametrize(
    "type_card_number, expected_result",
    [
        ("Visa Platinum 7000792289606361", "Visa Platinum 7000 79** **** 6361"),
        ("Maestro 7000792289606361", "Maestro 7000 79** **** 6361"),
        ("Счет 73654108430135874305", "Счет **4305"),
    ],
)
````
Данные для test_get_date
````
@pytest.mark.parametrize(
    "string_date, expected_result",
    [("2024-03-11T02:26:18.671407", "11.03.2024"), ("2023-12-31T23:59:59.999999", "31.12.2023")],
)
````
#### test_mask_account_card
Тест функции mask_account_card
#### test_mask_account_card_invalid
Тест функции mask_account_card на ошибки ValueError
#### test_get_date
Тест функции get_date
#### test_get_date_invalid
Тест функции get_date на ошибки TypeError

### test_generators
```
@pytest.fixture
def transactions() -> list[dict]:
    return [
        {
            "id": 939719570,
            "state": "EXECUTED",
            "date": "2018-06-30T02:08:58.425572",
            "operationAmount": {"amount": "9824.07", "currency": {"name": "USD", "code": "USD"}},
            "description": "Перевод организации",
            "from": "Счет 75106830613657916952",
            "to": "Счет 11776614605963066702",
        },
        {
            "id": 142264268,
            "state": "EXECUTED",
            "date": "2019-04-04T23:20:05.206878",
            "operationAmount": {"amount": "79114.93", "currency": {"name": "USD", "code": "USD"}},
            "description": "Перевод со счета на счет",
            "from": "Счет 19708645243227258542",
            "to": "Счет 75651667383060284188",
        },
        {
            "id": 873106923,
            "state": "EXECUTED",
            "date": "2019-03-23T01:09:46.296404",
            "operationAmount": {"amount": "43318.34", "currency": {"name": "руб.", "code": "RUB"}},
            "description": "Перевод со счета на счет",
            "from": "Счет 44812258784861134719",
            "to": "Счет 74489636417521191160",
        },
        {
            "id": 895315941,
            "state": "EXECUTED",
            "date": "2018-08-19T04:27:37.904916",
            "operationAmount": {"amount": "56883.54", "currency": {"name": "USD", "code": "USD"}},
            "description": "Перевод с карты на карту",
            "from": "Visa Classic 6831982476737658",
            "to": "Visa Platinum 8990922113665229",
        },
        {
            "id": 594226727,
            "state": "CANCELED",
            "date": "2018-09-12T21:27:25.241689",
            "operationAmount": {"amount": "67314.70", "currency": {"name": "руб.", "code": "RUB"}},
            "description": "Перевод организации",
            "from": "Visa Platinum 1246377376343588",
            "to": "Счет 14211924144426031657",
        },
    ]
```
#### test_filter_by_currency
Этот тест проверяет, что функция filter_by_currency корректно фильтрует транзакции по заданной валюте, и что полученные идентификаторы транзакций совпадают с ожидаемыми.
#### test_filter_by_currency_no_matches
Тест на правильную обработку случаев, когда транзакции в заданной валюте отсутствуют.
#### test_filter_by_currency_empty_list
Тест на обработку пустого списка или списка без соответствующих валютных операций.
#### test_transaction_descriptions
Функция возвращает корректные описания для каждой транзакции.
#### test_transaction_descriptions_empty_list
Тест функции с различным количеством входных транзакций, включая пустой список.
#### test_card_number_generator
Проверяет, что генератор выдает правильные номера карт в заданном диапазоне.
#### test_card_number_generator_edge_cases
Проверка на корректность форматирования номеров карт.
#### test_card_number_generator_invalid_range
Тест на корректную обработку крайних значений диапазона и правильного завершения генерации.
### test_decorators
#### test_successful_execution
Успешное выполнение, missing_ok
#### test_error_handling
При ошибке выполнения log, my_function error: ZeroDivisionError\n" "Inputs: (1, 0), {}\n" "Traceback:\n
#### test_logging_to_file
Проверяется, что при успешном выполнении функции информация корректно записывается в файл.
#### test_logging_to_file
При успешном выполнении функции информация корректно записывается в файл.